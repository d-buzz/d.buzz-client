version: 2

executors:
  global-executor:
    orbs:
      discord: antonioned/discord@0.1.0
    commands:
      send_status: discord/status
    docker:
        - image: node:14.7.0
    working_directory: /tmp/dbuzz-client

jobs:
  test_build_prod:
      executor: global-executor
      steps:
        - checkout
        - run: npm install
        - run: npm run lint
        - run: npm run build:prod
        - send_status:
            webhook: https://discordapp.com/api/webhooks/747082285828014170/6TLGC1_wgAAT91n5s3PYZxC9n2_Tj5BzqHQo2tO9miZxnVGKWusD3YA-pO2GjVvOWzuF
      filters:
        branches:
          only: master

  test_build_dev:
      executor: global-executor
      steps:
        - checkout
        - run: npm install
        - run: npm run lint
        - run: npm run build:dev
        - send_status:
            webhook: https://discordapp.com/api/webhooks/747082285828014170/6TLGC1_wgAAT91n5s3PYZxC9n2_Tj5BzqHQo2tO9miZxnVGKWusD3YA-pO2GjVvOWzuF
      filters:
        branches:
          ignore: master


workflows:
  version: 2
  environment_builds:
    jobs:
    - test_build_dev
    - test_build_prod
